<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Let&#39;s write a macro in Rust - Part 1 - hackeryarn</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="Macros are required to do some very helpful things in Rust, but this isn&rsquo;t an article about any of those things.
I became ennamored with macros many years ago when I read Practical Common Lisp and saw the implementation of a SQL DSL that works with built in data structures. The whole implementation took less than a screen of code and absolutely blew away my expectations of what it took to create DSLs.
" /><meta name="keywords" content="blog, tech, ideas" />






<meta name="generator" content="Hugo 0.148.1 with theme even" />


<link rel="canonical" href="https://hackeryarn.com/post/rust-macros-1/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b21c25b30b65a0cc5fa7853ee7d0a14a33817ce15313d5f58fc3a0e8c473d999.css" rel="stylesheet">



<meta property="og:url" content="https://hackeryarn.com/post/rust-macros-1/">
  <meta property="og:site_name" content="hackeryarn">
  <meta property="og:title" content="Let&#39;s write a macro in Rust - Part 1">
  <meta property="og:description" content="Macros are required to do some very helpful things in Rust, but this isn’t an article about any of those things.
I became ennamored with macros many years ago when I read Practical Common Lisp and saw the implementation of a SQL DSL that works with built in data structures. The whole implementation took less than a screen of code and absolutely blew away my expectations of what it took to create DSLs.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-08-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-17T00:00:00+00:00">

  <meta itemprop="name" content="Let&#39;s write a macro in Rust - Part 1">
  <meta itemprop="description" content="Macros are required to do some very helpful things in Rust, but this isn’t an article about any of those things.
I became ennamored with macros many years ago when I read Practical Common Lisp and saw the implementation of a SQL DSL that works with built in data structures. The whole implementation took less than a screen of code and absolutely blew away my expectations of what it took to create DSLs.">
  <meta itemprop="datePublished" content="2025-08-17T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-08-17T00:00:00+00:00">
  <meta itemprop="wordCount" content="1333">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Let&#39;s write a macro in Rust - Part 1">
  <meta name="twitter:description" content="Macros are required to do some very helpful things in Rust, but this isn’t an article about any of those things.
I became ennamored with macros many years ago when I read Practical Common Lisp and saw the implementation of a SQL DSL that works with built in data structures. The whole implementation took less than a screen of code and absolutely blew away my expectations of what it took to create DSLs.">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">hackeryarn</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="https://liberapay.com/hackeryarn">
        <li class="mobile-menu-item">Donate</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">hackeryarn</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://liberapay.com/hackeryarn">Donate</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Let&#39;s write a macro in Rust - Part 1</h1>

      <div class="post-meta">
        <span class="post-time"> 2025-08-17 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#prior-art">Prior art</a></li>
    <li><a href="#macro-design-process">Macro design process</a>
      <ul>
        <li><a href="#dont-write-macros">Don&rsquo;t write macros</a></li>
      </ul>
    </li>
    <li><a href="#the-simplest-query-macro">The simplest query! macro</a>
      <ul>
        <li><a href="#our-first-match-arm">Our first match arm</a></li>
        <li><a href="#implementing-single-field-select">Implementing single field select</a></li>
      </ul>
    </li>
    <li><a href="#conclusion-for-now">Conclusion&hellip; for now</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Macros are required to do some very helpful things in Rust, but this isn&rsquo;t an article about any of those things.</p>
<p>I became ennamored with macros many years ago when I read <a href="https://gigamonkeys.com/book/">Practical Common Lisp</a> and saw the implementation of a SQL DSL that works with built in data structures. The whole implementation took less than a screen of code and absolutely blew away my expectations of what it took to create DSLs.</p>
<p>In this article, I will try to share some of that excitement with you while using Rust&rsquo;s macro system. Will this be the most practical and useful macro you can write? Absolutely not. I only hope to show you some possibilities of this powerful tool.</p>
<h2 id="prior-art">Prior art</h2>
<p>Rust&rsquo;s macros build on top of a long legacy of syntax macros primarily seen in the Lisp language family. Unlige Go, C, and Assembly macros, which work as a pre-processor step on raw strings, Rust&rsquo;s macros work dircectly on the AST (<a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree</a>). This means that Tokenization and AST parsing has already occurred, so you can be sure that the what you work with is at least shaped like hypothetican Rust code.</p>
<p>Unlike the Lisp family of languages, Rust had some additional challenges to overcome with their macro implementation.</p>
<p>Lisp has a syntax that&rsquo;s basically an AST, so it is extremely easy to consume and produce an AST, because it looks like normar code. Rust, on the other hand, looks nothing like Lisp or an AST, so it needs a way to elegantly handle these conversion steps. That&rsquo;s where the <code>macro_rules!</code> macro comes in, which will be the focus of this article.</p>
<p>The other challenge within <code>macro_rules!</code> comes from Rust&rsquo;s goal to provide as much help and correctness as possible. Rust actually supports types (technically fragment-specifiers) in macros. We will see more of this later, but it goes towards making macros easier to write, reason about, and maintain.</p>
<p>Without further ado, let&rsquo;s jump into using <code>macro_rules!</code> and declerative macros.</p>
<h2 id="macro-design-process">Macro design process</h2>
<p>Since every time we write a macro, we creat a DSL it&rsquo;s important to keep some rules and processes in mind. With that in mind, these are the typical steps that we should follow when writing macros:</p>
<ul>
<li>Evaluate if you need a macro</li>
<li>Design the simplest possible invocation first (determine what your DSL looks like)</li>
<li>Try to implement a match arms and adjust the invocation as needed</li>
<li>Work one match arm at a time</li>
<li>Write sub macros where possible</li>
</ul>
<p>Some of these steps might not mean much to you yet, but we will walk through them a few times while designing our final macro.</p>
<h3 id="dont-write-macros">Don&rsquo;t write macros</h3>
<p>Before we start writing a macro, we should always evaluate if it is the best choice for the problem in hand. I know this is an odd step to start with for an article about writing macros, but macros get frequently abused, and we should strive to use all our tools well.</p>
<p>Macros bring a lot of complexity in writing and debugging them. You are introducing another compilation step in your code, and often times erasing some of Rust&rsquo;s ability to help you write correct code. On top of all this, making code generic enough for macros can lead to far more complex types than you could accomplish with a little more boilerplate.</p>
<p>Because of this overhead, you have to really consider the tradeoffs that you&rsquo;re making. Rust is a powerful language with lots of abstractions. Often times, the existing tools can get you to your goal without resorting to macros.</p>
<p>In our case, we are writing the macro for practice, so these concerns don&rsquo;t apply here.</p>
<h2 id="the-simplest-query-macro">The simplest query! macro</h2>
<p>Lets jump right to the second step and design our invocation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="fm">query!</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">title</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>db</code> will be the data structure that we want to query. We will start with supporting a single argument <code>select</code> for picking a field from the items in the data structure. Working in the abstract makes it really hard to reason about how we want this structure to work, so let&rsquo;s put together some sample data.</p>
<p>We will borrow the domain from Practical Common Lisp and work with a list of songs. A song is a simple structure:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Song</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">title</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">artist</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">rating</span>: <span class="kt">i64</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>And to make a database of songs, we can just throw a bunch of songs into a vector:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Song</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;Hate Me&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;Blue October&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Song</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;Not Like Us&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;Kendrick Lamar&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Song</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;Bad Dreams&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;Teddy Swims&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Song</span>::<span class="n">new</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;Rockin&#39; the Suburbs&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;Ben Folds&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">6</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Song</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;Lateralus&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;Tool&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Song</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;Lose Control&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;Teddy Swims&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Song</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;Come as you are&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;Nirvana&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="mi">9</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">];</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Now if we come back to our invocation, we can fill in the desired output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="fm">query!</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">title</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// &gt; [&#34;Hate Me&#34;, &#34;Not Like Us&#34;, &#34;Bad Dreams&#34;, &#34;Rockin&#39; the Suburbs&#34;, &#34;Lateralus&#34;, &#34;Lose Control&#34;, &#34;Come as you are&#34;]
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="our-first-match-arm">Our first match arm</h3>
<p>Now that we know what we want our dsl to look like and what it should output, we can start working on our macro. Let&rsquo;s look at the implementation and fill in the gaps from there:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[macro_export]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">macro_rules</span><span class="o">!</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="cp">$db</span>:<span class="nc">ident</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="cp">$field</span>:<span class="nc">ident</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>If you want to follow along, remember that macros need to be declared in their own module.</p></blockquote>
<p>The basic syntax is <code>($matcher) =&gt; {$expansion}</code>. If you squint, it looks just like a <code>match</code> statement, and that&rsquo;s what makes these types of macros so easy to work with.</p>
<p>Just about everything in the matcher is treated as a literal. <code>$</code> denotes a variable for what we actually want to capture. Everything that we capture must also have a fragment-specifier (you can think of it as a type). There are 14 possible fragment-specifiers that we could capture, see <a href="https://doc.rust-lang.org/reference/macros-by-example.html#metavariables">Metavariables</a> for a full list, but in our case we are only capturing <code>ident</code>.</p>
<p><code>ident</code> denotes an actual identifier or keyword declared somewhere outside the macro. We capture two identifiers. One for the database what we want to query, and one for the field that we want to extract.</p>
<p>We can run this declaration to make sure it executes without any error, but we won&rsquo;t see any result a until we implement the expansion.</p>
<h3 id="implementing-single-field-select">Implementing single field select</h3>
<p>Now that we have a match, we need to put it to use.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[macro_export]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">macro_rules</span><span class="o">!</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="cp">$db</span>:<span class="nc">ident</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="cp">$field</span>:<span class="nc">ident</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="cp">$db</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="cp">$field</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This is the part where we get to make the decisions of how our macro works. I am choosing to use <code>into_iter</code> so that our macro can work with anything that implements the <code>Iterator</code> trait. This is great for flexibility and an intuitive choice. But, it reveals a weakness of macros. We have no way to help the user know that they need to provide an <code>Iterator</code>. They would need to read the docs or guess correctly.</p>
<p>You can also see the flexibility of the <code>ident</code> fragment specifier. We are using it for a variable and a struct field name.</p>
<p>With this implementation we can actually run our macro, and get the expected output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="n">results</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">query!</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">title</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// &gt; [&#34;Hate Me&#34;, &#34;Not Like Us&#34;, &#34;Bad Dreams&#34;, &#34;Rockin&#39; the Suburbs&#34;, &#34;Lateralus&#34;, &#34;Lose Control&#34;, &#34;Come as you are&#34;]
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>And if we mistype the field name, we get a very helpful error message:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="n">results</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">query!</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">titles</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// &gt; no field `titles` on type `Song`
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="conclusion-for-now">Conclusion&hellip; for now</h2>
<p>This article sets up the groundwork for the macro that we want to build. Our goal is to get to macro like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="fm">query!</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">rating</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">rating</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">artist</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#34;Tool&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In the next part we will make progress toward that goal and explore some more advanced macro techniques.</p>

    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/rust-macros-2/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Let&#39;s write a macro in Rust - Part 2</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/maps/">
            <span class="next-text nav-default">You don&#39;t need a map for that</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'achernyak';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/hackeryarn" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.linkedin.com/in/achernyak" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/hackeryarn" class="iconfont icon-github" title="github"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
