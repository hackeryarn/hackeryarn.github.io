<!DOCTYPE html>
<html class="latte" lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="fediverse:creator" content="@hackeryarn@mastodon.social">
  
  
  
  <title>hackeryarn | Hierarchies in Hakyll</title>
  
  <link rel="icon" type="image/svg" href="/imgs/hackeryarn.svg" />
  <link rel="stylesheet" href="/css/generated.css">
  
  <link rel="alternate" type="application/atom+xml" title="Atom Feed for https://hackeryarn.com"
    href="/atom.xml" />
  
  <script defer src="/js/main.bundle.js" data-auto-replace-svg="nest"></script>
</head>

<body hx-boost="true" hx-ext="head-support" class="flex flex-col justify-between h-screen">
  <header class="top-0 w-full z-10 flex justify-between items-center mb-7 lg:text-8xl text-4xl p-5">
  <a class="logo flex items-center no-underline lg:gap-5 gap-2 neutral-900 italianno" href="https://hackeryarn.com">
    <img class="inline lg:w-20 w-10 rounded-full" src="/imgs/hackeryarn.svg" /> hackeryarn
  </a>
  <nav class="carrois lg:text-3xl text-lg">
    <ul class="flex gap-3 lg:gap-6">
      <li>
        <a href="https://hackeryarn.com">posts</a>
      </li>
      <li>
        <a href="https://hackeryarn.com/tags">tags</a>
      </li>
      <li>
        <a href="https://hackeryarn.com/about">about</a>
      </li>
    </ul>
  </nav>
</header>
  <section class="w-full mx-auto mb-auto prose-neutral prose lg:prose-2xl px-6">
    
<article>
  <h1 class="title">
    Hierarchies in Hakyll
  </h1>
  <p class="subtitle">Published 2019-03-27</p>
  <div>
    <p>Creating hierarchy in a blog is a useful technique. It allows you to
have different sections by type of content. It lets users navigate by
their interests quickly. It makes your blog organized.</p>
<span id="continue-reading"></span>
<p>My need for a hierarchy came when working on another blog - <a rel="external" href="https://dailyreadingnotes.com">Daily
Reading Notes</a>. That blog involves notes
on books I read daily. Since each book has multiple reading notes, I
wanted to allow two forms of navigation: by a grouping of all notes for
a particular book and by posted date. The groupings also needed to be
dynamic. I didn't want to write code or updated configurations every
time I added a new book.</p>
<p><a rel="external" href="https://jaspervdj.be/hakyll/">Hakyll</a> didn't support this out of the
box, and I didn't find examples of anyone using similar layouts. So, I
created my own approach which I am now sharing.</p>
<h1 id="structuring-the-posts-directory">Structuring the posts directory</h1>
<p>In order to build a dynamic hierarchy, the directory structures needs to
support association of the books with their related posts.</p>
<p>We start our implementation by creating a page and a folder with the
name of the book inside the <code>posts</code> directory. This naming convention
allows us to link the book's page to the folder containing the posts.</p>
<p>Our directory structure should have the following layout:</p>
<pre class="giallo z-code"><code data-lang="plain"><span class="giallo-l"><span>posts</span></span>
<span class="giallo-l"><span>+-- book-title.md</span></span>
<span class="giallo-l"><span>+-- book-title</span></span>
<span class="giallo-l"><span>|   +-- post1.md</span></span>
<span class="giallo-l"><span>|   +-- post2.md</span></span></code></pre><h1 id="matching-the-routes">Matching the Routes</h1>
<p>With the directory structure in place, we can proceed to creating
matchers for the books and posts pages.</p>
<p>For the books pages, we match all the files in the <code>posts</code> directory
while ignoring directories and their contents. We also set the extension
of these file to <code>html</code>. The extension need to be specified because the
original files are written in markdown.</p>
<p>For the posts pages, we use <code>posts/*/*</code> as the matcher string. The first
<code>*</code> tells <code>match</code> to look inside any directory within <code>posts</code>. The
second <code>*</code> tells <code>match</code> to gets all the files inside the subdirectory.
These file are also written in markdown and need their extension set to
<code>html</code>.</p>
<p>The matchers with extensions look like this:</p>
<pre class="giallo z-code"><code data-lang="haskell"><span class="giallo-l"><span class="z-entity z-name z-function">main</span><span class="z-keyword z-operator"> ::</span><span class="z-storage z-type"> IO</span><span class="z-punctuation"> ()</span></span>
<span class="giallo-l"><span class="z-source">main </span><span class="z-keyword z-operator">=</span></span>
<span class="giallo-l"><span class="z-source">hakyll </span><span class="z-keyword z-operator">$</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">match </span><span class="z-punctuation z-definition z-string z-string">&quot;posts/*&quot;</span><span class="z-keyword z-operator"> $</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">  route </span><span class="z-keyword z-operator">$</span><span class="z-source"> setExtension </span><span class="z-punctuation z-definition z-string z-string">&quot;html&quot;</span></span>
<span class="giallo-l"><span class="z-keyword z-operator">  ...</span></span>
<span class="giallo-l"><span class="z-source">match </span><span class="z-punctuation z-definition z-string z-string">&quot;posts/*/*&quot;</span></span>
<span class="giallo-l"><span class="z-source">  route </span><span class="z-keyword z-operator">$</span><span class="z-source"> setExtension </span><span class="z-punctuation z-definition z-string z-string">&quot;html&quot;</span></span>
<span class="giallo-l"><span class="z-keyword z-operator">  ...</span></span></code></pre><h1 id="getting-the-posts-for-a-book">Getting the Posts for a Book</h1>
<p>Now that we are matching the books and posts pages, we need to group the
posts by their respective book. For this purpose, we write a small
helper function that takes the output of
<a rel="external" href="https://jaspervdj.be/hakyll/">Hakyll's</a> <code>getResourceFilePath</code>
function.</p>
<p>Our function takes the file path for the book page, strips out
everything but the file name, and add a glob pattern to the end.</p>
<pre class="giallo z-code"><code data-lang="haskell"><span class="giallo-l"><span class="z-entity z-name z-function">getBookFolder</span><span class="z-keyword z-operator"> ::</span><span class="z-storage z-type"> FilePath</span><span class="z-keyword z-operator"> -&gt;</span><span class="z-storage z-type"> Pattern</span></span>
<span class="giallo-l"><span class="z-source">getBookFolder </span><span class="z-keyword z-operator">=</span><span class="z-source"> fromGlob </span><span class="z-keyword z-operator">.</span><span class="z-punctuation"> (</span><span class="z-keyword z-operator">++</span><span class="z-punctuation z-definition z-string z-string"> &quot;/*&quot;</span><span class="z-punctuation">)</span><span class="z-keyword z-operator"> .</span><span class="z-source"> takeWhile </span><span class="z-punctuation">(</span><span class="z-keyword z-operator">/=</span><span class="z-punctuation z-definition z-string z-string"> &#39;.&#39;</span><span class="z-punctuation">)</span><span class="z-keyword z-operator"> .</span><span class="z-source"> drop </span><span class="z-constant z-numeric">3</span><span class="z-keyword z-operator"> .</span><span class="z-source"> show</span></span></code></pre>
<p>We use this function in the books pages matcher to get a list of the
book's posts as an input for the newly created <code>bookCtx</code>.</p>
<p>Creating the <code>bookCtx</code> goes in the <code>compile</code> block:</p>
<pre class="giallo z-code"><code data-lang="haskell"><span class="giallo-l"><span class="z-entity z-name z-function">main</span><span class="z-keyword z-operator"> ::</span><span class="z-storage z-type"> IO</span><span class="z-punctuation"> ()</span></span>
<span class="giallo-l"><span class="z-source">main </span><span class="z-keyword z-operator">=</span></span>
<span class="giallo-l"><span class="z-source">  hakyll </span><span class="z-keyword z-operator">$</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">    match </span><span class="z-punctuation z-definition z-string z-string">&quot;posts/*&quot;</span><span class="z-keyword z-operator"> $</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">      route </span><span class="z-keyword z-operator">$</span><span class="z-source"> setExtension </span><span class="z-punctuation z-definition z-string z-string">&quot;html&quot;</span></span>
<span class="giallo-l"><span class="z-source">      compile </span><span class="z-keyword z-operator">$</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">        filepath </span><span class="z-keyword z-operator">&lt;-</span><span class="z-source"> getResourceFilePath</span></span>
<span class="giallo-l"><span class="z-source">        posts </span><span class="z-keyword z-operator">&lt;-</span><span class="z-source"> recentFirst </span><span class="z-keyword z-operator">=&lt;&lt;</span><span class="z-source"> loadAll </span><span class="z-punctuation">(</span><span class="z-source">getBookFolder filepath</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-keyword">        let</span><span class="z-source"> bookCtx </span><span class="z-keyword z-operator">=</span><span class="z-source"> listField </span><span class="z-punctuation z-definition z-string z-string">&quot;posts&quot;</span><span class="z-source"> defaultContext </span><span class="z-punctuation">(</span><span class="z-source">return posts</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-keyword z-operator">        ...</span></span></code></pre>
<p>This <code>compile</code> block is similar to the auto generated example that lists
all the posts. Except, we generate the path for the posts relatively to
the current file.</p>
<h1 id="applying-templates">Applying Templates</h1>
<p>In the final step, we apply templates to both outputs. The book pages
need a new template that uses the <code>posts</code> list context field we
generated in the previous step. The posts can continue using the default
<code>post</code> template. In addition to the individual templates, both the
matchers will need the default template and the <code>relativizeUrls</code> helper.</p>
<p>The final output of the two matchers looks like this:</p>
<pre class="giallo z-code"><code data-lang="haskell"><span class="giallo-l"><span class="z-entity z-name z-function">main</span><span class="z-keyword z-operator"> ::</span><span class="z-storage z-type"> IO</span><span class="z-punctuation"> ()</span></span>
<span class="giallo-l"><span class="z-source">main </span><span class="z-keyword z-operator">=</span></span>
<span class="giallo-l"><span class="z-source">  hakyll </span><span class="z-keyword z-operator">$</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">    match </span><span class="z-punctuation z-definition z-string z-string">&quot;posts/*&quot;</span><span class="z-keyword z-operator"> $</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">      route </span><span class="z-keyword z-operator">$</span><span class="z-source"> setExtension </span><span class="z-punctuation z-definition z-string z-string">&quot;html&quot;</span></span>
<span class="giallo-l"><span class="z-source">      compile </span><span class="z-keyword z-operator">$</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">        filepath </span><span class="z-keyword z-operator">&lt;-</span><span class="z-source"> getResourceFilePath</span></span>
<span class="giallo-l"><span class="z-source">        posts </span><span class="z-keyword z-operator">&lt;-</span><span class="z-source"> recentFirst </span><span class="z-keyword z-operator">=&lt;&lt;</span><span class="z-source"> loadAll </span><span class="z-punctuation">(</span><span class="z-source">getBookFolder filepath</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-keyword">        let</span><span class="z-source"> bookCtx </span><span class="z-keyword z-operator">=</span><span class="z-source"> listField </span><span class="z-punctuation z-definition z-string z-string">&quot;posts&quot;</span><span class="z-source"> defaultContext </span><span class="z-punctuation">(</span><span class="z-source">return posts</span><span class="z-punctuation">)</span></span>
<span class="giallo-l"><span class="z-source">        getResourceBody </span><span class="z-keyword z-operator">&gt;&gt;=</span><span class="z-source"> applyAsTemplate bookCtx </span><span class="z-keyword z-operator">&gt;&gt;=</span></span>
<span class="giallo-l"><span class="z-source">          loadAndApplyTemplate </span><span class="z-punctuation z-definition z-string z-string">&quot;templates/book.html&quot;</span><span class="z-source"> bookCtx </span><span class="z-keyword z-operator">&gt;&gt;=</span></span>
<span class="giallo-l"><span class="z-source">          loadAndApplyTemplate </span><span class="z-punctuation z-definition z-string z-string">&quot;templates/default.html&quot;</span><span class="z-source"> bookCtx </span><span class="z-keyword z-operator">&gt;&gt;=</span></span>
<span class="giallo-l"><span class="z-source">          relativizeUrls</span></span>
<span class="giallo-l"><span class="z-source">    match </span><span class="z-punctuation z-definition z-string z-string">&quot;posts/*/*&quot;</span><span class="z-keyword z-operator"> $</span><span class="z-keyword"> do</span></span>
<span class="giallo-l"><span class="z-source">      route </span><span class="z-keyword z-operator">$</span><span class="z-source"> setExtension </span><span class="z-punctuation z-definition z-string z-string">&quot;html&quot;</span></span>
<span class="giallo-l"><span class="z-source">      compile </span><span class="z-keyword z-operator">$</span></span>
<span class="giallo-l"><span class="z-source">        pandocCompiler </span><span class="z-keyword z-operator">&gt;&gt;=</span><span class="z-source"> loadAndApplyTemplate </span><span class="z-punctuation z-definition z-string z-string">&quot;templates/post.html&quot;</span><span class="z-source"> postCtx </span><span class="z-keyword z-operator">&gt;&gt;=</span></span>
<span class="giallo-l"><span class="z-source">        loadAndApplyTemplate </span><span class="z-punctuation z-definition z-string z-string">&quot;templates/default.html&quot;</span><span class="z-source"> postCtx </span><span class="z-keyword z-operator">&gt;&gt;=</span></span>
<span class="giallo-l"><span class="z-source">        relativizeUrls</span></span></code></pre><h1 id="wrapping-up">Wrapping up</h1>
<p>With these matchers in place, we have a hierarchy of books containing
the posts related to them. We can add books by creating a new page and
folder with the name of the book. This setup made it easy for me to
maintain a hierarchical site. I hope it does the same for you.</p>
<p>The final result of a book page looks like this: <a rel="external" href="https://dailyreadingnotes.com/posts/the-lean-startup.html">The Lean Startup book
page</a>. The
full code for <a rel="external" href="https://dailyreadingnotes.com/">Daily Reading Notes</a> is
available on
<a rel="external" href="https://github.com/hackeryarn/daily-reading-notes/tree/develop">github</a>.</p>

  </div>
  <hr />
  <div class="not-prose -mt-10">
    

<ul class="not-prose flex gap-3">
  
  <li>
    <a href="https://hackeryarn.com/tags/tutorial/"
      class="prose lg:prose-2xl underline decoration-dotted transition text-neutral-500 hover:text-neutral-900">tutorial</a>
  </li>
  
  <li>
    <a href="https://hackeryarn.com/tags/haskell/"
      class="prose lg:prose-2xl underline decoration-dotted transition text-neutral-500 hover:text-neutral-900">haskell</a>
  </li>
  
</ul>


  </div>
</article>


  </section>
  <footer class="p-4 mt-15">
  <div class="flex justify-center text-4xl gap-6">
    <a href="https://mastodon.social/@hackeryarn">
      <i class="fa-brands fa-mastodon"></i>
    </a>
    <a href="https://codeberg.org/hackeryarn">
      <i class="codeberg"></i>
    </a>
    <a href="https://github.com/hackeryarn">
      <i class="fa-brands fa-github"></i>
    </a>
    <a href="https://www.linkedin.com/in/achernyak/">
      <i class="fa-brands fa-linkedin"></i>
    </a>
  </div>
  <p class="text-center text-neutral-500 mt-5">
    Copyright 2026 by Artem Chernyak
  </p>
</footer>
  <a class="hidden" rel="me" href="https://mastodon.social/@hackeryarn">Mastodon</a>
</body>

</html>