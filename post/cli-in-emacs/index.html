<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>CLI Commands in Emacs - hackeryarn</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Artem Chernyak" /><meta name="description" content="A few months ago, Gabriel Gonzalez wrote an excellent article on creating useful tools with Haskell. He used an example of a small CLI tool that aligns the equals signs of a multi-line text input. The article wrapped up by integrating this tool into vim.
I love the overarching concept in the article: create small tools that are useful in multiple contexts. It&#39;s directly inline with the Unix philosophy.
The only problem is that I am an Emacs user." /><meta name="keywords" content="blog, tech, ideas" />






<meta name="generator" content="Hugo 0.55.4 with even 4.0.0" />


<link rel="canonical" href="https://hackeryarn.com/post/cli-in-emacs/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">



<meta property="og:title" content="CLI Commands in Emacs" />
<meta property="og:description" content="A few months ago, Gabriel Gonzalez wrote an excellent article on creating useful tools with Haskell. He used an example of a small CLI tool that aligns the equals signs of a multi-line text input. The article wrapped up by integrating this tool into vim.
I love the overarching concept in the article: create small tools that are useful in multiple contexts. It&#39;s directly inline with the Unix philosophy.
The only problem is that I am an Emacs user." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hackeryarn.com/post/cli-in-emacs/" />
<meta property="article:published_time" content="2019-06-01T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-06-01T00:00:00&#43;00:00"/>

<meta itemprop="name" content="CLI Commands in Emacs">
<meta itemprop="description" content="A few months ago, Gabriel Gonzalez wrote an excellent article on creating useful tools with Haskell. He used an example of a small CLI tool that aligns the equals signs of a multi-line text input. The article wrapped up by integrating this tool into vim.
I love the overarching concept in the article: create small tools that are useful in multiple contexts. It&#39;s directly inline with the Unix philosophy.
The only problem is that I am an Emacs user.">


<meta itemprop="datePublished" content="2019-06-01T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-06-01T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1107">



<meta itemprop="keywords" content="guide,emacs," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CLI Commands in Emacs"/>
<meta name="twitter:description" content="A few months ago, Gabriel Gonzalez wrote an excellent article on creating useful tools with Haskell. He used an example of a small CLI tool that aligns the equals signs of a multi-line text input. The article wrapped up by integrating this tool into vim.
I love the overarching concept in the article: create small tools that are useful in multiple contexts. It&#39;s directly inline with the Unix philosophy.
The only problem is that I am an Emacs user."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">hackeryarn</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="https://liberapay.com/hackeryarn">
        <li class="mobile-menu-item">Donate</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">hackeryarn</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://liberapay.com/hackeryarn">Donate</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">CLI Commands in Emacs</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-06-01 </span>
        <div class="post-category">
            <a href="/categories/emacs/"> Emacs </a>
            <a href="/categories//">  </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    
  </div>
</div>
    <div class="post-content">
      <p>A few months ago, Gabriel Gonzalez wrote an <a href="http://www.haskellforall.com/2018/10/detailed-walkthrough-for-beginner.html" title="excellent article">excellent article</a> on creating useful
tools with Haskell. He used an example of a small CLI tool that aligns the
equals signs of a multi-line text input. The article wrapped up by integrating
this tool into vim.</p>

<p>I love the overarching concept in the article: create small tools that are
useful in multiple contexts. It's directly inline with the Unix philosophy.</p>

<p>The only problem is that I am an Emacs user. So in this article, I wanted to
show how I get the same effect in Emacs. And demonstrating how to
take CLI interaction in the text editor even further.</p>

<h1 id="take-action-on-a-region">Take Action on a Region</h1>

<p>In his article, Gabriel uses the command he created to take action on a region.
This involves selecting text and executing a CLI command on it's contents --
replacing the region with the command's output.</p>

<p>For this example, we will use the command from Gabrial's article,
~align-equals~. To see the full implementation and learn a little Haskell, 
you can read his <a href="http://www.haskellforall.com/2018/10/detailed-walkthrough-for-beginner.html" title="article">article</a>. Or you can follow along while keeping the below
command's usage in mind:</p>

<p>$ align-equals
  foo = 1
  a = 2
  asdf = 3
  <Ctrl-D>
  foo  = 1
  a    = 2
  asdf = 3</p>

<p>Emacs has a built in command, <code>shell-command-on-region</code>, which executes the
specified command on the selected region. This would work for our example, but
it requires two commands. First you execute <code>shell-command-on-region</code>, then you
provide the command you want to run. If the cli command needs flags or
arguments, it becomes tedious to put in every time. Wouldn't it be nice if we
could select a region and only run one command?</p>

<p>To accomplish this, we need a wrapper. This implementation combines a couple
elisp components. We start our function by expecting the beginning and ending of
the region as arguments. The region(<code>r</code>) flag passed to <code>interactive</code> ensure
that the correct arguments get passed in.</p>

<p><code>interactive</code> lets us invoke our function from anywhere, and supports <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Interactive-Codes.html#Interactive-Codes" title="many more
options">many more
options</a>, which I encourage you to explore on your own.</p>

<p>With our region bounds ready, we call <code>shell-command-on-region</code> to
executes a shell command on a region specified by the beginning(<code>b</code>) and
ending(<code>e</code>) arguments. We also supply the shell command to execute, and two
flags which make the command replace the selected region.</p>

<p>(defun align-equals (b e) 
  (interactive "r")
  (shell-command-on-region b e "align-equals" t t))</p>

<p>We can expand the CLI command in this wrapper to take any number or arguments
and flags. No matter how we change it, we can still invoke it with one command:
~<M-x> align-equals~.</p>

<h1 id="take-action-on-a-buffer">Take Action on a Buffer</h1>

<p>A common scenario I run into, is wanting to run a tool on the whole file. This
normally comes in two variants. I either want to modify the content of the file
in some way, like using a beautifier. Or I want to produce an output based on
the file content, like getting totals or showing lint errors.</p>

<p>Again, there are built in ways to do this, but a wrapper lets us do more with
our shell commands.</p>

<h2 id="replacing-buffer-contents">Replacing Buffer Contents</h2>

<p>This time, we don't need to pass any arguments to <code>interactive</code>. Instead, we use
~shell-command-on-region~ with the results of calling <code>point-min</code> and
~point-max~ -- the start and end of the buffer, respectively.</p>

<p>(defun align-buffer ()
  (interactive)
  (shell-command-on-region (point-min) (point-max) "align-equals" t t))</p>

<p><code>align-buffer</code> aligns the entire buffer without the need to manually select a
region. This makes the it less error prone and easier to execute. We can't
select the region incorrectly, because we don't need to anymore. We only need to
execute <code>&lt;M-x&gt; align-buffer</code>.</p>

<h2 id="displaying-the-output-of-a-shell-command">Displaying The Output of a Shell Command</h2>

<p>code.</p>

<p><code>eslint</code> is different from our previous command. It takes a file name, not the
buffer contents. This means we will need to use some new functions.</p>

<p>Once again, we don't accept any arguments and pass nothing to <code>interactive</code>. We
get the buffer name by using the <code>buffer-name</code> function. Once we have the name,
we merge it with the string <code>eslint</code> to create the final command, and pass it to
~shell-command~. This logs the output to a dedicate shell command buffer.</p>

<p>(defun run-eslint ()
  (interactive)
  (let ((current-file (buffer-name (current-buffer))))
    (shell-command (concat "eslint " current-file))))</p>

<p>Now we can execute <code>run-eslint</code> in any JavaScript file and see the results of
executing the command.</p>

<p>Seeing the results is a good start. But <code>eslint</code> comes with a handy <code>--fix</code> flag
that automatically fixes simple problems.</p>

<p>To add this flag you only need to change the string you pass to <code>shell-command</code>.</p>

<p>(shell-command (concat "eslint --fix" current-file))))</p>

<p>With that change, the simple issues get fixed automatically and we get a
log of the complex issues to fix manually.</p>

<h1 id="running-command-automatically">Running Command Automatically</h1>

<p>From the last example we have a useful <code>run-eslint</code> function. But we need to
remember to run it every time we want to check a file. Let's reduce our mental
burden, and let Emacs automatically execute this function every time we save a
JavaScript file.</p>

<p>There are two facilities that makes automatic function execution precise and
safe: modes and hooks.</p>

<p>Modes allow us to know what context we are in. When we open a new file, a number
of modes can activate. For our example, there is a built in <code>js-mode</code> that
activates when we open a JavaScript file.</p>

<p>We will hook into the activation of this mode to limit the scope of our automatic
function execution to only JavaScript files. We wouldn't want to execute a
command that changes file contents in an unsupported file type.</p>

<p>Once we are inside <code>js-mode</code>, we will add another hook -- this time to an
action. Since <code>eslint</code> can fix some issues for us, we will run it before the
file is saved by hooking onto the <code>before-save</code> action.</p>

<p>In the implementation, we use <code>add-hook</code> to listen to the two action described
above. <code>js-mode-hook</code> only needs the function to execute when the mode is
activated. But <code>before-save-hook</code> needs the <code>LOCAL</code> option. This only runs the
action in the buffer it was activated in. Without this flag, <code>eslint</code> would run
on every file after we opened any JavaScript file.</p>

<p>(add-hook 'js-mode-hook
            (lambda ()
              (add-hook 'before-save-hook 'run-eslint nil t)))</p>

<h1 id="going-further">Going Further</h1>

<p>I only scratched the surface of what's possible with Elisp. Projects like <a href="https://magit.vc/" title="magit">magit</a>
provide amazing examples of extending basic CLI tools.</p>

<p>Magit is a wrapper around git. It doesn't change what git does. Instead, it adds
on text manipulation and file awareness that Emacs is good at. If you need
inspiration for how to integrate other tools into Emacs, look no further.</p>

<p>I hope that this article provided some inspiration and a few new tricks. Happy
hacking.</p>

    </div>

    <footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/guide/">guide</a>
          <a href="/tags/emacs/">emacs</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/hierarchies-in-hakyll/">
            <span class="next-text nav-default">Hierarchies In a Hakyll Blog</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'achernyak';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/hackeryarn" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.linkedin.com/in/achernyak" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/hackeryarn" class="iconfont icon-github" title="github"></a>
  <a href="https://hackeryarn.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Artem Chernyak</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-72377824-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
